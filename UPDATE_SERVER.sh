#!/bin/bash

# ============================================
# –°–ö–†–ò–ü–¢ –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ö–û–î–ê –ù–ê –°–ï–†–í–ï–†–ï
# ============================================

echo "üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Labosfera –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
echo ""

SERVER="root@109.73.192.44"
PROJECT_DIR="/opt/Labosfera"

echo "üì° –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É $SERVER..."
echo ""

ssh $SERVER << 'ENDSSH'

cd /opt/Labosfera

echo "üì• –°–∫–∞—á–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å GitHub..."
git pull origin main

echo ""
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º backend —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏..."
docker-compose -f docker-compose.prod.yml up -d --build backend

echo ""
echo "‚è≥ –ñ–¥—ë–º 10 —Å–µ–∫—É–Ω–¥ –ø–æ–∫–∞ backend –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è..."
sleep 10

echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
docker-compose -f docker-compose.prod.yml ps

echo ""
echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ backend:"
docker-compose -f docker-compose.prod.yml logs --tail=20 backend

echo ""
echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üß™ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "  1. –§–æ—Ä–º—É –Ω–∞ —Å–∞–π—Ç–µ: https://labosfera.ru"
echo "  2. –ö–æ—Ä–∑–∏–Ω—É: –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
echo "  3. Telegram: –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
echo ""

ENDSSH

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç."
