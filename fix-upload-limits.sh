#!/bin/bash

# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ nginx
echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ª–∏–º–∏—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ nginx..."

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
echo "üèóÔ∏è  –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ nginx —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π..."
docker compose -f docker-compose.prod.yml build --no-cache nginx

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ nginx..."
docker compose -f docker-compose.prod.yml up -d nginx

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ nginx..."
sleep 5

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx..."
docker compose -f docker-compose.prod.yml exec nginx nginx -t

echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ª–∏–º–∏—Ç–æ–≤..."
docker compose -f docker-compose.prod.yml exec nginx grep -A2 -B2 "client_max_body_size" /etc/nginx/nginx.conf

echo ""
echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üìã –ù–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã:"
echo "   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 50MB"
echo "   - –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è: 300 —Å–µ–∫—É–Ω–¥"
echo "   - –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ /admin/ –∏ /api/ –º–∞—Ä—à—Ä—É—Ç–∞–º"
echo ""
echo "üß™ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ 50MB –≤ –∞–¥–º–∏–Ω–∫–µ!"
echo "üåê –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: https://labosfera.ru/admin/"